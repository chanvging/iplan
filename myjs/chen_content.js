chen_pack = new Array();function formated_num(num, cur){	var str = '';	if(num==cur){		str = '<label style="color:red;">'+num+'</label>';	}else{		str = '<a href="javascript:chen_content(\'\','+num+');">'+num+'</a>';	}	return str;}function mk_page_idx(cur, total){	var t_page = parseInt(total,10);	if(t_page<total){t_page++;}	//alert(t_page);	if(t_page<2){return '';}	//if(t_page<2){return formated_num(1,cur);}	var prev = cur>2 ? true : false;	var next = cur<total-1 ? true : false;	var page_html = '';	if(prev){		page_html += '<a href="javascript:chen_content(\'\', \'prev\');">prev</a> '+formated_num(1,cur)+' ...';	}else{		page_html += formated_num(1,cur);	}	if(cur!=1 && cur!=t_page){page_html += ' '+formated_num(cur,cur)+' ';}else{page_html += ' ';}	if(next){		page_html += '... '+formated_num(t_page,cur)+' <a href="javascript:chen_content(\'\', \'next\');">next</a>';	}else{		page_html += formated_num(t_page,cur);	}	return page_html;}function updata_list(data, id){	if(id != chen_pack.cur_status){return false;}	var box = chen_pack[id].box;	var page = chen_pack[id].page_idx;	box.html('');	page.html(mk_page_idx(chen_pack[id].page, chen_pack[id].all_page));	if(data==''){data = [];}	var mb = '';	var html = '';	var end = '';	if(typeof(chen_pack[id].mb)=='string'){		mb = chen_pack[id].mb;	}else{		html = chen_pack[id].mb[0];		mb = chen_pack[id].mb[1];		end = chen_pack[id].mb[2];	}		var len = data.length;	for(var i=0;i<len;i++){		tmpmb = mb;		for(var j in data[i]){			data[i][j] = data[i][j].replace(/\$/g, '&#36;');			tmpmb = tmpmb.replace(new RegExp('#'+j+'#', 'g'), data[i][j]);		}		html += tmpmb;	}	html += end;	box.html(html);}function handle_data(data, page, id){	var len = data.length;	if(id != chen_pack.cur_status){return false;}	if(len==0){updata_list('', id); return false;}	if(page<1){alert('reach the begin'); return false;}	var count = chen_pack[id].count;	var all_page = chen_pack[id].all_page;	if(all_page<=page-1){alert('reach the end'); return false;}	chen_pack[id].page = page;	var real_data = data.slice((page-1)*count, page*count);	updata_list(real_data,id);}function chen_content(id, direc){	if(!chen_pack){chen_pack = new Array();}	if(!id){id = chen_pack.cur_status;}	if(id==chen_pack.cur_status && !direc){return false;}	if(id != chen_pack.cur_status){		chen_pack.cur_status = id;	}	if(chen_pack && chen_pack[id] && chen_pack[id].data){		var the_pack = chen_pack[id];		var data = the_pack.data;		var page = the_pack.page;		if(direc=='next'){			page = the_pack.page + 1;		}else if(direc=='prev'){			page = the_pack.page - 1;		}else{			var tmp = parseInt(direc);			if(tmp>0){page = tmp;}		}		handle_data(the_pack.data, page, id);	}else{		if(typeof(chen_option[id])=='undefined'){alert('no this');return false;}		chen_pack[id] = {			box:$('#'+chen_option[id].boxid),			mb:chen_option[id].mbstr,			page:1,			count:chen_option[id].count,			page_idx:$('#'+chen_option[id].page_idx)		}		if(chen_option[id].url){			$.get(chen_option[id].url, function(data){//alert(data[0].title);				chen_pack[id].data = data;				chen_pack[id].all_page = data.length/chen_pack[id].count;				handle_data(data, 1, id);			}, 'json');		}else{			chen_pack[id].data = [{info:$('#'+chen_option[id].fromid).html()}];			handle_data(chen_pack[id].data, 1, id);		}	}}